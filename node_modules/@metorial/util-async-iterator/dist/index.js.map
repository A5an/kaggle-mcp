{"version":3,"sources":["../src/asyncIterator.ts"],"sourcesContent":["export let createProgrammableAsyncIterator = <Y, R>() => {\n  let nextValueStack: { type: 'throw' | 'yield' | 'finish'; value: any }[] = [];\n  let resolveNext: ((value: IteratorResult<Y, R>) => void) | null = null;\n  let rejectNext: ((error: any) => void) | null = null;\n  let ended = false;\n\n  let iterator = {\n    [Symbol.asyncIterator]() {\n      return this;\n    },\n\n    async next(): Promise<IteratorResult<Y, R>> {\n      let nextValue = nextValueStack.shift();\n      if (nextValue) {\n        if (nextValue.type == 'throw') throw nextValue.value;\n\n        if (nextValue.type == 'finish') {\n          return {\n            value: nextValue.value,\n            done: true\n          } as IteratorResult<Y, R>;\n        }\n\n        return {\n          value: nextValue.value,\n          done: false\n        } as IteratorResult<Y, R>;\n      }\n\n      return new Promise<IteratorResult<Y, R>>((resolve, reject) => {\n        resolveNext = resolve;\n        rejectNext = reject;\n      });\n    }\n  };\n\n  return {\n    yield(value: Y) {\n      if (ended) return;\n\n      if (resolveNext) {\n        resolveNext({ value, done: false });\n        resolveNext = null;\n      } else {\n        nextValueStack.push({ type: 'yield', value });\n      }\n    },\n\n    throw(error: Error) {\n      if (ended) return;\n      ended = true;\n\n      if (rejectNext) {\n        rejectNext(error);\n        rejectNext = null;\n      } else {\n        nextValueStack.push({ type: 'throw', value: error });\n      }\n    },\n\n    finish(value: R) {\n      if (ended) return;\n      ended = true;\n\n      if (resolveNext) {\n        resolveNext({ value, done: true });\n        resolveNext = null;\n      } else {\n        nextValueStack.push({ type: 'finish', value });\n      }\n    },\n\n    iterator\n  };\n};\n"],"mappings":";AAAO,IAAI,kCAAkC,MAAY;AACvD,MAAI,iBAAuE,CAAC;AAC5E,MAAI,cAA8D;AAClE,MAAI,aAA4C;AAChD,MAAI,QAAQ;AAEZ,MAAI,WAAW;AAAA,IACb,CAAC,OAAO,aAAa,IAAI;AACvB,aAAO;AAAA,IACT;AAAA,IAEA,MAAM,OAAsC;AAC1C,UAAI,YAAY,eAAe,MAAM;AACrC,UAAI,WAAW;AACb,YAAI,UAAU,QAAQ;AAAS,gBAAM,UAAU;AAE/C,YAAI,UAAU,QAAQ,UAAU;AAC9B,iBAAO;AAAA,YACL,OAAO,UAAU;AAAA,YACjB,MAAM;AAAA,UACR;AAAA,QACF;AAEA,eAAO;AAAA,UACL,OAAO,UAAU;AAAA,UACjB,MAAM;AAAA,QACR;AAAA,MACF;AAEA,aAAO,IAAI,QAA8B,CAAC,SAAS,WAAW;AAC5D,sBAAc;AACd,qBAAa;AAAA,MACf,CAAC;AAAA,IACH;AAAA,EACF;AAEA,SAAO;AAAA,IACL,MAAM,OAAU;AACd,UAAI;AAAO;AAEX,UAAI,aAAa;AACf,oBAAY,EAAE,OAAO,MAAM,MAAM,CAAC;AAClC,sBAAc;AAAA,MAChB,OAAO;AACL,uBAAe,KAAK,EAAE,MAAM,SAAS,MAAM,CAAC;AAAA,MAC9C;AAAA,IACF;AAAA,IAEA,MAAM,OAAc;AAClB,UAAI;AAAO;AACX,cAAQ;AAER,UAAI,YAAY;AACd,mBAAW,KAAK;AAChB,qBAAa;AAAA,MACf,OAAO;AACL,uBAAe,KAAK,EAAE,MAAM,SAAS,OAAO,MAAM,CAAC;AAAA,MACrD;AAAA,IACF;AAAA,IAEA,OAAO,OAAU;AACf,UAAI;AAAO;AACX,cAAQ;AAER,UAAI,aAAa;AACf,oBAAY,EAAE,OAAO,MAAM,KAAK,CAAC;AACjC,sBAAc;AAAA,MAChB,OAAO;AACL,uBAAe,KAAK,EAAE,MAAM,UAAU,MAAM,CAAC;AAAA,MAC/C;AAAA,IACF;AAAA,IAEA;AAAA,EACF;AACF;","names":[]}