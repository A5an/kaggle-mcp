{"version":3,"sources":["../src/metorialOpenAICompatible.ts"],"names":[],"mappings":";AAAA,SAAS,oBAAoB;AA2BtB,IAAI,+BAA+B,CAAC,SACzC,aAAa,EAAE,OAAO,EAAE,MAAM,OAAO;AAAA,EACnC,OAAO,MAAM,SAAS,EAAE;AAAA,IACtB,OAAE;AA9BR;AA+BS;AAAA,QACC,MAAM;AAAA,QACN,UAAU;AAAA,UACR,MAAM,EAAE;AAAA,UACR,cAAa,OAAE,gBAAF,YAAiB;AAAA,UAC9B,YAAY,EAAE,gBAAgB,aAAa;AAAA,QAC7C;AAAA,MACF;AAAA;AAAA,EACJ;AAAA,EAEA,WAAW,OACT,UAEA,QAAQ;AAAA,IACN,MAAM,IAAI,OAAM,SAAQ;AACtB,UAAI,OAAO,MAAM,QAAQ,KAAK,SAAS,IAAI;AAC3C,UAAI,CAAC,MAAM;AACT,eAAO;AAAA,UACL,cAAc,KAAK;AAAA,UACnB,MAAM;AAAA,UACN,SAAS,2BAA2B,KAAK,SAAS,IAAI;AAAA,QACxD;AAAA,MACF;AAEA,UAAI,OAAY,CAAC;AAEjB,UAAI;AACF,YAAI,OAAO,KAAK,SAAS,aAAa,UAAU;AAC9C,iBAAO,KAAK,MAAM,KAAK,SAAS,SAAS;AAAA,QAC3C,OAAO;AACL,iBAAO,KAAK,SAAS;AAAA,QACvB;AAAA,MACF,SAAS,GAAQ;AACf,eAAO;AAAA,UACL,cAAc,KAAK;AAAA,UACnB,MAAM;AAAA,UACN,SAAS,gDAAgD,EAAE,OAAO;AAAA,QACpE;AAAA,MACF;AAEA,UAAI;AACF,YAAI,SAAS,MAAM,KAAK,KAAK,IAAI;AAEjC,eAAO;AAAA,UACL,cAAc,KAAK;AAAA,UACnB,MAAM;AAAA,UACN,SAAS,KAAK,UAAU,MAAM;AAAA,QAChC;AAAA,MACF,SAAS,GAAQ;AACf,eAAO;AAAA,UACL,cAAc,KAAK;AAAA,UACnB,MAAM;AAAA,UACN,SAAS,6BAA6B,EAAE,OAAO;AAAA,QACjD;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH;AACJ,EAAE","sourcesContent":["import { createMcpSdk } from '@metorial/mcp-sdk-utils';\n\nexport interface MetorialOpenAiCompatibleFunctionTool {\n  type: 'function';\n  function: {\n    name: string;\n    description?: string;\n    parameters: any;\n    strict?: boolean;\n  };\n}\n\nexport interface MetorialOpenAiCompatibleToolCall {\n  id: string;\n  type: 'function';\n  function: {\n    name: string;\n    arguments: string;\n  };\n}\n\nexport interface MetorialOpenAiCompatibleToolResult {\n  role: 'tool';\n  tool_call_id: string;\n  content: string;\n}\n\nexport let createOpenAICompatibleMcpSdk = (opts?: { withStrict?: boolean }) =>\n  createMcpSdk()(async ({ tools }) => ({\n    tools: tools.getTools().map(\n      t =>\n        ({\n          type: 'function' as const,\n          function: {\n            name: t.id,\n            description: t.description ?? undefined,\n            parameters: t.getParametersAs('json-schema')\n          }\n        }) satisfies MetorialOpenAiCompatibleFunctionTool\n    ) as MetorialOpenAiCompatibleFunctionTool[],\n\n    callTools: async (\n      calls: MetorialOpenAiCompatibleToolCall[]\n    ): Promise<MetorialOpenAiCompatibleToolResult[]> =>\n      Promise.all(\n        calls.map(async call => {\n          let tool = tools.getTool(call.function.name);\n          if (!tool) {\n            return {\n              tool_call_id: call.id,\n              role: 'tool' as const,\n              content: `[ERROR] Tool with name \"${call.function.name}\" not found.`\n            } satisfies MetorialOpenAiCompatibleToolResult;\n          }\n\n          let data: any = {};\n\n          try {\n            if (typeof call.function.arguments == 'string') {\n              data = JSON.parse(call.function.arguments);\n            } else {\n              data = call.function.arguments;\n            }\n          } catch (e: any) {\n            return {\n              tool_call_id: call.id,\n              role: 'tool' as const,\n              content: `[ERROR] Invalid JSON in tool call arguments: ${e.message}`\n            } satisfies MetorialOpenAiCompatibleToolResult;\n          }\n\n          try {\n            let result = await tool.call(data);\n\n            return {\n              tool_call_id: call.id,\n              role: 'tool' as const,\n              content: JSON.stringify(result)\n            } satisfies MetorialOpenAiCompatibleToolResult;\n          } catch (e: any) {\n            return {\n              tool_call_id: call.id,\n              role: 'tool' as const,\n              content: `[ERROR] Tool call failed: ${e.message}`\n            } satisfies MetorialOpenAiCompatibleToolResult;\n          }\n        })\n      )\n  }));\n"]}