{"version":3,"sources":["../src/metorialGoogle.ts"],"names":[],"mappings":";AACA,SAAS,oBAAoB;AAEtB,IAAI,iBAAiB,aAAa,EAAE,OAAO,EAAE,MAAM,OAAO;AAAA,EAC/D,OAAO;AAAA,IACL;AAAA,MACE,sBAAsB,MAAM,SAAS,EAAE;AAAA,QACrC,OAAE;AAPV;AAQW;AAAA,YACC,MAAM,EAAE;AAAA,YACR,cAAa,OAAE,gBAAF,YAAiB;AAAA,YAC9B,YAAY,EAAE,gBAAgB,eAAe;AAAA,UAC/C;AAAA;AAAA,MACJ;AAAA,IACF;AAAA,EACF;AAAA,EAEA,WAAW,OAAO,WAA6C;AAAA,IAC7D,MAAM;AAAA,IACN,OAAO,MAAM,QAAQ;AAAA,MACnB,MAAM,IAAI,OAAM,SAAQ;AACtB,YAAI,OAAO,MAAM,QAAQ,KAAK,IAAK;AACnC,YAAI,CAAC,MAAM;AACT,iBAAO;AAAA,YACL,kBAAkB;AAAA,cAChB,IAAI,KAAK;AAAA,cACT,MAAM,KAAK;AAAA,cACX,UAAU;AAAA,gBACR,OAAO,2BAA2B,KAAK,IAAI;AAAA,cAC7C;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAEA,YAAI,OAAY,CAAC;AAEjB,YAAI;AACF,cAAI,OAAO,KAAK,QAAQ,UAAU;AAChC,mBAAO,KAAK,MAAM,KAAK,IAAI;AAAA,UAC7B,OAAO;AACL,mBAAO,KAAK;AAAA,UACd;AAAA,QACF,SAAS,GAAQ;AACf,iBAAO;AAAA,YACL,kBAAkB;AAAA,cAChB,IAAI,KAAK;AAAA,cACT,MAAM,KAAK;AAAA,cACX,UAAU;AAAA,gBACR,OAAO,gDAAgD,EAAE,OAAO;AAAA,cAClE;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAEA,YAAI;AACF,cAAI,SAAS,MAAM,KAAK,KAAK,IAAI;AAEjC,iBAAO;AAAA,YACL,kBAAkB;AAAA,cAChB,IAAI,KAAK;AAAA,cACT,MAAM,KAAK;AAAA,cACX,UAAU;AAAA,YACZ;AAAA,UACF;AAAA,QACF,SAAS,GAAQ;AACf,iBAAO;AAAA,YACL,kBAAkB;AAAA,cAChB,IAAI,KAAK;AAAA,cACT,MAAM,KAAK;AAAA,cACX,UAAU;AAAA,gBACR,OAAO,6BAA6B,EAAE,OAAO;AAAA,cAC/C;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AACF,EAAE","sourcesContent":["import { Content, FunctionCall, FunctionDeclaration, Part, ToolUnion } from '@google/genai';\nimport { createMcpSdk } from '@metorial/mcp-sdk-utils';\n\nexport let metorialGoogle = createMcpSdk()(async ({ tools }) => ({\n  tools: [\n    {\n      functionDeclarations: tools.getTools().map(\n        t =>\n          ({\n            name: t.id,\n            description: t.description ?? undefined,\n            parameters: t.getParametersAs('openapi-3.0.0') as any\n          }) satisfies FunctionDeclaration\n      )\n    }\n  ] as ToolUnion[],\n\n  callTools: async (calls: FunctionCall[]): Promise<Content> => ({\n    role: 'user',\n    parts: await Promise.all(\n      calls.map(async call => {\n        let tool = tools.getTool(call.name!);\n        if (!tool) {\n          return {\n            functionResponse: {\n              id: call.id,\n              name: call.name,\n              response: {\n                error: `[ERROR] Tool with name \"${call.name}\" not found.`\n              }\n            }\n          } satisfies Part;\n        }\n\n        let data: any = {};\n\n        try {\n          if (typeof call.args == 'string') {\n            data = JSON.parse(call.args);\n          } else {\n            data = call.args;\n          }\n        } catch (e: any) {\n          return {\n            functionResponse: {\n              id: call.id,\n              name: call.name,\n              response: {\n                error: `[ERROR] Invalid JSON in tool call arguments: ${e.message}`\n              }\n            }\n          } satisfies Part;\n        }\n\n        try {\n          let result = await tool.call(data);\n\n          return {\n            functionResponse: {\n              id: call.id,\n              name: call.name,\n              response: result\n            }\n          } satisfies Part;\n        } catch (e: any) {\n          return {\n            functionResponse: {\n              id: call.id,\n              name: call.name,\n              response: {\n                error: `[ERROR] Tool call failed: ${e.message}`\n              }\n            }\n          } satisfies Part;\n        }\n      })\n    )\n  })\n}));\n"]}