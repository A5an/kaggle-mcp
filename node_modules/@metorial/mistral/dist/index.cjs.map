{"version":3,"sources":["../src/metorialMistral.ts"],"names":[],"mappings":";AAAA,SAAS,oBAAoB;AAGtB,IAAI,kBAAkB,aAAa,EAAE,OAAO,EAAE,MAAM,MAAM;AAC/D,MAAI,WAAW,MAAM,SAAS;AAE9B,SAAO;AAAA,IACL,OAAO,SAAS,IAAI,OAAK;AAP7B;AAQM,UAAI,aAAa,EAAE,gBAAgB,aAAa;AAGhD,UAAI,cAAc,OAAO,eAAe,UAAU;AAEhD,mBAAW,uBAAuB;AAGlC,YAAI,WAAW,YAAY;AACzB,iBAAO,OAAO,WAAW,UAAU,EAAE,QAAQ,CAAC,SAAc;AAC1D,gBAAI,QAAQ,OAAO,SAAS,YAAY,KAAK,SAAS,UAAU;AAC9D,mBAAK,uBAAuB;AAAA,YAC9B;AAAA,UACF,CAAC;AAAA,QACH;AAAA,MACF;AAEA,aAAO;AAAA,QACL,MAAM;AAAA,QACN,UAAU;AAAA,UACR,MAAM,EAAE;AAAA,UACR,cAAa,OAAE,gBAAF,YAAiB;AAAA,UAC9B;AAAA,UACA,QAAQ;AAAA,QACV;AAAA,MACF;AAAA,IACF,CAAC;AAAA,IAED,WAAW,OAAO,UAChB,QAAQ;AAAA,MACN,MAAM,IAAI,OAAM,SAAQ;AACtB,YAAI,OAAO,MAAM,QAAQ,KAAK,SAAS,IAAI;AAC3C,YAAI,CAAC,MAAM;AACT,iBAAO;AAAA,YACL,YAAY,KAAK;AAAA,YACjB,MAAM;AAAA,YACN,SAAS,2BAA2B,KAAK,SAAS,IAAI;AAAA,UACxD;AAAA,QACF;AAEA,YAAI,OAAY,CAAC;AAEjB,YAAI;AACF,cAAI,OAAO,KAAK,SAAS,aAAa,UAAU;AAC9C,mBAAO,KAAK,MAAM,KAAK,SAAS,SAAS;AAAA,UAC3C,OAAO;AACL,mBAAO,KAAK,SAAS;AAAA,UACvB;AAAA,QACF,SAAS,GAAQ;AACf,iBAAO;AAAA,YACL,YAAY,KAAK;AAAA,YACjB,MAAM;AAAA,YACN,SAAS,gDAAgD,EAAE,OAAO;AAAA,UACpE;AAAA,QACF;AAEA,YAAI;AACF,cAAI,SAAS,MAAM,KAAK,KAAK,IAAI;AAEjC,iBAAO;AAAA,YACL,YAAY,KAAK;AAAA,YACjB,MAAM;AAAA,YACN,SAAS,KAAK,UAAU,MAAM;AAAA,UAChC;AAAA,QACF,SAAS,GAAQ;AACf,iBAAO;AAAA,YACL,YAAY,KAAK;AAAA,YACjB,MAAM;AAAA,YACN,SAAS,6BAA6B,EAAE,OAAO;AAAA,UACjD;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACJ;AACF,CAAC","sourcesContent":["import { createMcpSdk } from '@metorial/mcp-sdk-utils';\nimport { Tool, ToolCall, ToolMessage } from '@mistralai/mistralai/models/components';\n\nexport let metorialMistral = createMcpSdk()(async ({ tools }) => {\n  let toolList = tools.getTools();\n\n  return {\n    tools: toolList.map(t => {\n      let parameters = t.getParametersAs('json-schema') as any;\n\n      // Ensure additionalProperties: false is set for Mistral compatibility\n      if (parameters && typeof parameters === 'object') {\n        // Set additionalProperties: false on the root schema\n        parameters.additionalProperties = false;\n\n        // Also ensure nested objects have additionalProperties: false\n        if (parameters.properties) {\n          Object.values(parameters.properties).forEach((prop: any) => {\n            if (prop && typeof prop === 'object' && prop.type === 'object') {\n              prop.additionalProperties = false;\n            }\n          });\n        }\n      }\n\n      return {\n        type: 'function' as const,\n        function: {\n          name: t.id,\n          description: t.description ?? undefined,\n          parameters,\n          strict: true\n        }\n      } satisfies Tool;\n    }) as Tool[],\n\n    callTools: async (calls: ToolCall[]): Promise<ToolMessage[]> =>\n      Promise.all(\n        calls.map(async call => {\n          let tool = tools.getTool(call.function.name);\n          if (!tool) {\n            return {\n              toolCallId: call.id,\n              role: 'tool' as const,\n              content: `[ERROR] Tool with name \"${call.function.name}\" not found.`\n            } satisfies ToolMessage;\n          }\n\n          let data: any = {};\n\n          try {\n            if (typeof call.function.arguments == 'string') {\n              data = JSON.parse(call.function.arguments);\n            } else {\n              data = call.function.arguments;\n            }\n          } catch (e: any) {\n            return {\n              toolCallId: call.id,\n              role: 'tool' as const,\n              content: `[ERROR] Invalid JSON in tool call arguments: ${e.message}`\n            } satisfies ToolMessage;\n          }\n\n          try {\n            let result = await tool.call(data);\n\n            return {\n              toolCallId: call.id,\n              role: 'tool' as const,\n              content: JSON.stringify(result)\n            } satisfies ToolMessage;\n          } catch (e: any) {\n            return {\n              toolCallId: call.id,\n              role: 'tool' as const,\n              content: `[ERROR] Tool call failed: ${e.message}`\n            } satisfies ToolMessage;\n          }\n        })\n      )\n  };\n});\n"]}