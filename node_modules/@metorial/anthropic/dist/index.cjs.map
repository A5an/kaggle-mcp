{"version":3,"sources":["../src/metorialAnthropic.ts"],"names":[],"mappings":";AAMA,SAAS,oBAAoB;AAEtB,IAAI,oBAAoB,aAAa,EAAE,OAAO,EAAE,MAAM,OAAO;AAAA,EAClE,OAAO,MAAM,SAAS,EAAE;AAAA,IACtB,OAAE;AAVN;AAWO;AAAA,QACC,MAAM,EAAE;AAAA,QACR,cAAa,OAAE,gBAAF,YAAiB;AAAA,QAC9B,cAAc,EAAE,gBAAgB,aAAa;AAAA,MAC/C;AAAA;AAAA,EACJ;AAAA,EAEA,WAAW,OAAO,WAAkD;AAAA,IAClE,MAAM;AAAA,IACN,SAAS,MAAM,QAAQ;AAAA,MACrB,MAAM,IAAI,OAAM,SAAQ;AACtB,YAAI,OAAO,MAAM,QAAQ,KAAK,IAAI;AAClC,YAAI,CAAC,MAAM;AACT,iBAAO;AAAA,YACL,MAAM;AAAA,YACN,aAAa,KAAK;AAAA,YAClB,SAAS,2BAA2B,KAAK,IAAI;AAAA,UAC/C;AAAA,QACF;AAEA,YAAI,OAAY,CAAC;AAEjB,YAAI;AACF,cAAI,OAAO,KAAK,SAAS,UAAU;AACjC,mBAAO,KAAK,MAAM,KAAK,KAAK;AAAA,UAC9B,OAAO;AACL,mBAAO,KAAK;AAAA,UACd;AAAA,QACF,SAAS,GAAQ;AACf,iBAAO;AAAA,YACL,MAAM;AAAA,YACN,aAAa,KAAK;AAAA,YAClB,SAAS,gDAAgD,EAAE,OAAO;AAAA,UACpE;AAAA,QACF;AAEA,YAAI;AACF,cAAI,SAAS,MAAM,KAAK,KAAK,IAAI;AAEjC,iBAAO;AAAA,YACL,MAAM;AAAA,YACN,aAAa,KAAK;AAAA,YAClB,SAAS,KAAK,UAAU,MAAM;AAAA,UAChC;AAAA,QACF,SAAS,GAAQ;AACf,iBAAO;AAAA,YACL,MAAM;AAAA,YACN,aAAa,KAAK;AAAA,YAClB,SAAS,6BAA6B,EAAE,OAAO;AAAA,UACjD;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AACF,EAAE","sourcesContent":["import {\n  MessageParam,\n  ToolResultBlockParam,\n  ToolUnion,\n  ToolUseBlock\n} from '@anthropic-ai/sdk/resources/messages';\nimport { createMcpSdk } from '@metorial/mcp-sdk-utils';\n\nexport let metorialAnthropic = createMcpSdk()(async ({ tools }) => ({\n  tools: tools.getTools().map(\n    t =>\n      ({\n        name: t.id,\n        description: t.description ?? undefined,\n        input_schema: t.getParametersAs('json-schema') as any\n      }) satisfies ToolUnion\n  ) as ToolUnion[],\n\n  callTools: async (calls: ToolUseBlock[]): Promise<MessageParam> => ({\n    role: 'user',\n    content: await Promise.all(\n      calls.map(async call => {\n        let tool = tools.getTool(call.name);\n        if (!tool) {\n          return {\n            type: 'tool_result',\n            tool_use_id: call.id,\n            content: `[ERROR] Tool with name \"${call.name}\" not found.`\n          } satisfies ToolResultBlockParam;\n        }\n\n        let data: any = {};\n\n        try {\n          if (typeof call.input == 'string') {\n            data = JSON.parse(call.input);\n          } else {\n            data = call.input;\n          }\n        } catch (e: any) {\n          return {\n            type: 'tool_result',\n            tool_use_id: call.id,\n            content: `[ERROR] Invalid JSON in tool call arguments: ${e.message}`\n          } satisfies ToolResultBlockParam;\n        }\n\n        try {\n          let result = await tool.call(data);\n\n          return {\n            type: 'tool_result',\n            tool_use_id: call.id,\n            content: JSON.stringify(result)\n          } satisfies ToolResultBlockParam;\n        } catch (e: any) {\n          return {\n            type: 'tool_result',\n            tool_use_id: call.id,\n            content: `[ERROR] Tool call failed: ${e.message}`\n          } satisfies ToolResultBlockParam;\n        }\n      })\n    )\n  })\n}));\n"]}